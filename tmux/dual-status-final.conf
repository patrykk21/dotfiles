# =====================================
# FINAL DUAL STATUS BAR SOLUTION
# =====================================

# First, reset to clean state
set -g status on
set -g status-position top
set -g status-justify centre
set -g status-bg "colour235"
set -g status-fg "colour250"

# Window tabs at top
set -g window-status-format "#[fg=colour250,bg=colour236] #I #[fg=colour243]#W "
set -g window-status-current-format "#[fg=colour235,bg=colour114] #I #[fg=colour235,bold]#W "
set -g window-status-separator ""
set -g status-left " "
set -g status-right "#[fg=colour243,bg=colour235] #S "

# Clean pane borders
set -g pane-border-status off
set -g pane-border-style "fg=colour235"
set -g pane-active-border-style "fg=colour235"

# =====================================
# BOTTOM STATUS BAR VIA OVERLAY WINDOW
# =====================================

# Create a persistent overlay window for bottom status
bind-key -n C-S-b run-shell -b '\
    if tmux list-windows -F "#{window_name}" | grep -q "^BOTTOM_STATUS_BAR$"; then \
        tmux kill-window -t BOTTOM_STATUS_BAR; \
    else \
        tmux new-window -d -n BOTTOM_STATUS_BAR \
            "while true; do \
                clear; \
                printf \"\\033[?25l\"; \
                status=\$(~/.config/tmux/scripts/status-bar.sh | sed \"s/#\\[[^]]*\\]//g\"); \
                cols=\$(tput cols); \
                rows=\$(tput lines); \
                tput cup \$((rows-1)) 0; \
                printf \"\\033[48;5;235m\\033[38;5;250m%*s\" \$cols \"\"; \
                tput cup \$((rows-1)) 0; \
                len=\${#status}; \
                padding=\$(( (cols - len) / 2 )); \
                printf \"%*s%s\" \$padding \"\" \"\$status\"; \
                sleep 0.5; \
             done" && \
        tmux swap-window -s BOTTOM_STATUS_BAR -t -1; \
    fi \
'

# Auto-start bottom bar on session creation
set-hook -g session-created 'run-shell -b "sleep 1 && tmux send-keys -t : C-S-b"'